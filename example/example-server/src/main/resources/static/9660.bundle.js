"use strict";(self.webpackChunkadmin_pro_ui=self.webpackChunkadmin_pro_ui||[]).push([[9660],{49660:(e,t,n)=>{n.r(t),n.d(t,{default:()=>w});var i=n(74848),r=n(20533),o=n.n(r),a=n(67493),c=n(62978),u=n(93658),s=n(34419),l=n(63532),d=n(16044),f=n(79249),v=n(78295),h=n(16143),p=n(42702),y=n(88562),b=n(44548),x=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{u(i.next(e))}catch(e){o(e)}}function c(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}u((i=i.apply(e,t||[])).next())}))},m=function(e,t){var n,i,r,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=c(0),a.throw=c(1),a.return=c(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(u){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(o=0)),o;)try{if(n=1,i&&(r=2&c[0]?i.return:c[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,c[1])).done)return r;switch(i=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,i=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){o.label=c[1];break}if(6===c[0]&&o.label<r[1]){o.label=r[1],r=c;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(c);break}r[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(e,o)}catch(e){c=[6,e],i=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}};const w=function(){var e=o().useState(!1),t=e[0],n=e[1],r=o().useState(!1),w=r[0],j=r[1],k=o().useRef(null),C=y.lV.useForm(),A=o().useRef(),I=o().useState(null),T=I[0],g=I[1],S=function(e){return x(void 0,void 0,void 0,(function(){var t;return m(this,(function(i){switch(i.label){case 0:return[4,(0,s.wQ)({id:T.id,schema:e})];case 1:return i.sent().success&&(l.Ay.success("保存成功"),n(!1)),null===(t=A.current)||void 0===t||t.reload(),[2]}}))}))},F=[{title:"编号",dataIndex:"id",search:!1},{title:"编码",dataIndex:"code"},{title:"标题",dataIndex:"title"},{title:"说明",dataIndex:"description",valueType:"text",search:!1},{title:"创建时间",dataIndex:"createTime",valueType:"dateTime",search:!1},{title:"修改时间",dataIndex:"updateTime",valueType:"dateTime",search:!1},{title:"状态",dataIndex:"enable",search:!1,render:function(e,t){return(0,i.jsx)(d.A,{title:"确认要".concat(t.enable?"禁用":"启用","吗？"),onConfirm:function(){return x(void 0,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return[4,(n=t.id,x(void 0,void 0,void 0,(function(){var e;return m(this,(function(t){switch(t.label){case 0:return[4,(0,s.Uk)(n)];case 1:return t.sent().success&&l.Ay.success("修改成功"),null===(e=A.current)||void 0===e||e.reload(),[2]}}))})))];case 1:return e.sent(),[2]}var n}))}))},children:(0,i.jsx)("a",{children:t.enable?"启用":"禁用"})})}},{title:"操作",valueType:"option",render:function(e,t){return[(0,i.jsx)("a",{onClick:function(){g(t),n(!0)},children:"设计"},"design"),(0,i.jsx)("a",{onClick:function(){C.setFieldsValue(t),j(!0)},children:"编辑"},"editable"),(0,i.jsx)("a",{onClick:function(){return x(void 0,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return[4,(n=t.id,x(void 0,void 0,void 0,(function(){var e;return m(this,(function(t){switch(t.label){case 0:return[4,(0,s.C)(n)];case 1:return t.sent().success&&l.Ay.success("复制成功"),null===(e=A.current)||void 0===e||e.reload(),[2]}}))})))];case 1:return e.sent(),[2]}var n}))}))},children:"复制"},"copy"),(0,i.jsx)(d.A,{title:"确认删除?",onConfirm:function(){return x(void 0,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return[4,(n=t.id,x(void 0,void 0,void 0,(function(){var e;return m(this,(function(t){switch(t.label){case 0:return[4,(0,s.TF)(n)];case 1:return t.sent().success&&l.Ay.success("保存成功"),null===(e=A.current)||void 0===e||e.reload(),[2]}}))})))];case 1:return e.sent(),[2]}var n}))}))},children:(0,i.jsx)("a",{children:"删除"},"delete")},"delete")]}}];return(0,i.jsxs)(c.LN,{children:[(0,i.jsx)(u.A,{"data-testid":"flow-table",actionRef:A,rowKey:"id",columns:F,toolBarRender:function(){return[(0,i.jsx)(f.Ay,{"data-testid":"flow-add-btn",type:"primary",onClick:function(){C.reset(),j(!0)},children:"新增"})]},request:function(e,t,n){return x(void 0,void 0,void 0,(function(){return m(this,(function(i){return[2,(0,s.p_)(e,t,n,[{key:"title",type:"LIKE"}])]}))}))}}),(0,i.jsx)(v.A,{"data-testid":"flow-editor",title:"编辑流程",open:w,destroyOnClose:!0,onClose:function(){j(!1)},onCancel:function(){j(!1)},onOk:function(){return x(void 0,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return[4,C.submit()];case 1:return e.sent(),[2]}}))}))},children:(0,i.jsxs)(y.lV,{form:C,layout:"vertical",onFinish:function(e){return x(void 0,void 0,void 0,(function(){var t,n;return m(this,(function(i){switch(i.label){case 0:return[4,(0,s.UN)(e)];case 1:return t=i.sent(),j(!1),t.success&&l.Ay.success("保存成功"),null===(n=A.current)||void 0===n||n.reload(),[2]}}))}))},children:[(0,i.jsx)(y.ZQ,{name:"id",hidden:!0}),(0,i.jsx)(y.ZQ,{name:"title",label:"标题",required:!0,validateFunction:b.wb.validateNotEmpty}),(0,i.jsx)(y.ZQ,{name:"code",label:"编码",required:!0,validateFunction:b.wb.validateNotEmpty}),(0,i.jsx)(y.Lz,{name:"description",label:"描述"}),(0,i.jsx)(y.ZQ,{name:"postponedMax",tooltip:"允许流程最大的延期次数",label:"最大延期次数",inputType:"number",required:!0,validateFunction:b.wb.validateNotEmpty}),(0,i.jsx)(y.$,{name:"skipIfSameApprover",tooltip:"是否跳过相同审批人，默认为否",label:"是否跳过相同审批人"})]})}),(0,i.jsx)(h.A,{title:"流程设计",width:"100%",open:t,onClose:function(){n(!1)},destroyOnClose:!0,style:{padding:0,margin:0},extra:(0,i.jsxs)(p.A,{children:[(0,i.jsx)(f.Ay,{type:"primary",onClick:function(){return x(void 0,void 0,void 0,(function(){var e,t,n;return m(this,(function(i){switch(i.label){case 0:return e=null===(n=k.current)||void 0===n?void 0:n.getData(),t=JSON.stringify(e),[4,S(t)];case 1:return i.sent(),[2]}}))}))},children:"保存"}),(0,i.jsx)(f.Ay,{onClick:function(){n(!1)},children:"取消"})]}),children:(0,i.jsx)(a.nl,{data:(null==T?void 0:T.schema)?JSON.parse(null==T?void 0:T.schema):null,actionRef:k})})]})}}}]);